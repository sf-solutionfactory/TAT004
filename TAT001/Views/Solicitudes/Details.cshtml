@model TAT001.Models.DocumentoFlujo

@{
    //ViewBag.Title = "Páginas";
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.pagina_r = 201;
    ViewBag.carpeta_r = 200;
}
<div class="row" style="margin-bottom:0">
    <div class="col s12 m5 l5">
        <div class="row" style="margin-bottom:0">
            <div class="input-field col s4">
                @Html.EditorFor(model => model.D.USUARIOC_ID, new { htmlAttributes = new { @disabled = "disabled" } })
                @Html.LabelFor(model => model.D.USUARIOC_ID, new { @id = "lbl_userid" })
            </div>
            <div class="input-field col s4">
                @*<input type="text" id="txt_user" value="@ViewBag.usuario.MANAGER" disabled="disabled" />
                    <label for="txt_user">Manager</label>*@
                @Html.EditorFor(model => model.D.USUARIO.MANAGER, new { htmlAttributes = new { @disabled = "disabled" } })
                @Html.LabelFor(model => model.D.USUARIO.MANAGER, new { @id = "lbl_manager" })
            </div>
            <div class="input-field col s4">
                @Html.EditorFor(model => model.D.USUARIO.BACKUP_ID, new { htmlAttributes = new { @disabled = "disabled" } })
                @Html.LabelFor(model => model.D.USUARIO.BACKUP_ID, new { @id = "lbl_backup" })
                @*<input type="text" id="txt_user" value="@ViewBag.usuario.BACKUP_ID" disabled="disabled" />
                    <label for="txt_user">Backup</label>*@
            </div>
        </div>
    </div>
    <div class="col s12 m2 l2">
        <div class="input-field col s6">
            @*<input type="text" id="txt_user" value="PRGA" disabled="disabled" />
                <label for="txt_user">BU</label>*@
            @Html.EditorFor(model => model.D.USUARIO.BUNIT, new { htmlAttributes = new { @disabled = "disabled" } })
            @Html.LabelFor(model => model.D.USUARIO.BUNIT, "Sociedad", new { @id = "lbl_bu" })
        </div>
        <div class="input-field col s6">
            @if (Model.D.ESTATUS == "N")
            {
                <input type="text" id="txt_status" value="Nuevo" disabled="disabled" />
                <label for="txt_status" id="lbl_status">Estatus</label>
            }
        </div>
    </div>
    <div class="col s12 m5 l5">
        <div class="row right">
            @if (ViewBag.acciones != null)
            {
                if (ViewBag.accion == "A" | ViewBag.accion == "R")
                {
                    @*<button type="button" class="btn-small" id="btn_workf">Acciones</button>*@
                    <div class="fixed-action-btn" id="lbl_wf">
                        <a class="btn-floating btn-large blue">
                            <i class="large material-icons">work</i>
                        </a>
                        <ul>
                            <li><a id="lbl_wfa" class="btn-floating green modal-trigger" href="#modal1" onclick="aprobar()"><i class="material-icons">check</i></a></li>
                            <li><a id="lbl_wfr" class="btn-floating red modal-trigger" href="#modal1" onclick="rechazar()"><i class="material-icons">close</i></a></li>
                        </ul>
                    </div>
                    <script>

                        var elem = document.querySelector('.fixed-action-btn');
                        var options = {
                            direction: 'left',
                            hoverEnabled: false,
                            toolbarEnabled: false
                        };
                        var instance = M.FloatingActionButton.init(elem, options);
                    </script>
                    @*<a id="lbl_wfa" class="btn-small" href="@Url.Action("Procesa", "Flujos", new { id = Model.D.NUM_DOC, accion = "A" })">Aprobar</a>
                        <a id="lbl_wfr" class="btn-small" href="@Url.Action("Procesa", "Flujos", new { id = Model.D.NUM_DOC, accion = "R" })">Rechazar</a>*@
                    <a class="btn modal-trigger" href="#modal1" onclick="aprobar()">Aprobar</a>
                    <a class="btn modal-trigger" href="#modal1" onclick="rechazar()">Rechazar</a>
                }
                else if (ViewBag.accion == "N")
                {
                    <div class="fixed-action-btn" id="lbl_wf">
                        <a class="btn-floating btn-large blue">
                            <i class="large material-icons">work</i>
                        </a>
                        <ul>
                            <li><a id="lbl_wfn" class="btn-floating yellow darken-1 modal-trigger" href="#modal1" onclick="siguiente()"><i class="material-icons">play_arrow</i></a></li>
                        </ul>
                    </div>
                    <script>

                        var elem = document.querySelector('.fixed-action-btn');
                        var options = {
                            direction: 'left',
                            hoverEnabled: false,
                            toolbarEnabled: false
                        };
                        var instance = M.FloatingActionButton.init(elem, options);
                    </script>
                    @*<a id="lbl_wfn" class="btn-small" href="@Url.Action("Procesa", "Flujos", new { id = Model.D.NUM_DOC, accion = "N" })">Siguiente</a>*@
                    <a id="lbl_wfn" class="btn modal-trigger" href="#modal1" onclick="siguiente()">Siguiente</a>
                }
                else if (ViewBag.accion == "P")
                {

                    <div class="fixed-action-btn" id="lbl_wf">
                        <a class="btn-floating btn-large blue">
                            <i class="large material-icons">work</i>
                        </a>
                        <ul>
                            <li><a id="lbl_wfn" class="btn-floating yellow darken-1 modal-trigger" href="#modal1" onclick="contabilizar()"><i class="material-icons">send</i></a></li>
                        </ul>
                    </div>
                    <script>

                        var elem = document.querySelector('.fixed-action-btn');
                        var options = {
                            direction: 'left',
                            hoverEnabled: false,
                            toolbarEnabled: false
                        };
                        var instance = M.FloatingActionButton.init(elem, options);
                    </script>
                    @*<a id="lbl_wfn" class="btn-small" href="@Url.Action("Procesa", "Flujos", new { id = Model.D.NUM_DOC, accion = "N" })">Siguiente</a>*@
                    <a id="lbl_wfn" class="btn modal-trigger" href="#modal1" onclick="contabilizar()">Contabilizar</a>
                }
            }
            else
            {<button type="button" class="btn-small" data-target="list_carta" id="btn_carta">Carta</button>
                <button type="button" class="btn-small" id="btn_cancel">Cancelar</button>
                <ul id='list_carta' class='dropdown-content'>
                    <li><a href="@Url.Action("Index", "CartaF", new { id = Model.D.NUM_DOC })" id="lbl_list">Ver cartas</a></li>
                    @if (Model.D.DOCUMENTOPs.Count().Equals(0))
                    {
                        <li><a href="@Url.Action("Create", "CartaF", new { id = Model.D.NUM_DOC })" id="lbl_genc">Generar carta</a></li>
                    }
                    else
                    {
                        <li><a href="@Url.Action("Create", "CartaV", new { id = Model.D.NUM_DOC })" id="lbl_genc">Generar carta</a></li>
                    }
                </ul>
                <script>
                    var elem = document.getElementById('btn_carta');
                    var options = {
                        constrainWidth: false
                        //,hover: true
                    };
                    var instance = M.Dropdown.init(elem, options);
                </script>
            }
        </div>
    </div>
</div>
<div class="row">
    <div class="col s12">
        <ul class="tabs tabs-fixed-width tab-demo " id="tab">
            <li class="tab col s2"><a class="active" href="#info" id="lbl_info">Información</a></li>
            <li class="tab col s2"><a href="#temp" id="lbl_temp">Temporalidad</a></li>
            <li class="tab col s2"><a href="#supp" id="lbl_supp">Soporte</a></li>
            <li class="tab col s2"><a href="#dist" id="lbl_dist">Distribución</a></li>
            <li class="tab col s2"><a href="#fina" id="lbl_fina">Financiera</a></li>
        </ul>
    </div>
    <div id="info" class="col s12" style="font-size:12px;">
        <div class="row">
            <div class="col s12 m6 l6">
                <div class="card-panel">
                    <div class="row" style="margin-bottom:0">
                        @*<div class="input-field col s12">
                                @Html.EditorFor(model => model.D.NUM_DOC, new { htmlAttributes = new { @disabled = "disabled" } })
                                @Html.LabelFor(model => model.D.NUM_DOC)
                            </div>*@
                        <div class="input-field col s12">
                            @Html.EditorFor(model => model.D.TSOL.TSOLTs.Where(a => a.SPRAS_ID.Equals(model.D.USUARIO.SPRAS_ID)).FirstOrDefault().TXT020, new { htmlAttributes = new { @disabled = "disabled" } })
                            @Html.LabelFor(model => model.D.TSOL, "Tipo de solicitud", new { @id = "lbl_tsol" })
                        </div>
                        <div class="input-field col s12">
                            @Html.EditorFor(model => model.D.TALL.TALLTs.Where(a => a.SPRAS_ID.Equals(model.D.USUARIO.SPRAS_ID)).FirstOrDefault().TXT50, new { htmlAttributes = new { @disabled = "disabled" } })
                            @Html.LabelFor(model => model.D.TALL, "Tipo de allowance", new { @id = "lbl_tall" })
                        </div>
                    </div>
                </div>
                <div class="card-panel">
                    <h5>Datos país</h5>
                    <div class="row" style="margin-bottom:0">

                        <div class="input-field col s6">
                            @Html.EditorFor(model => model.D.SOCIEDAD_ID, new { htmlAttributes = new { @disabled = "disabled" } })
                            @Html.LabelFor(model => model.D.SOCIEDAD, "Sociedad", new { @id = "lbl_bukrs" })
                        </div>
                        <div class="input-field col s6">
                            @Html.EditorFor(model => model.D.PAIS_ID, new { htmlAttributes = new { @disabled = "disabled" } })
                            @Html.LabelFor(model => model.D.PAIS_ID, "País", new { @id = "lbl_land" })
                        </div>
                        <div class="input-field col s6">
                            @Html.EditorFor(model => model.D.ESTADO, new { htmlAttributes = new { @disabled = "disabled" } })
                            @Html.LabelFor(model => model.D.ESTADO, "Estado", new { @id = "lbl_state" })
                        </div>
                        <div class="input-field col s6">
                            @Html.EditorFor(model => model.D.CIUDAD, new { htmlAttributes = new { @disabled = "disabled" } })
                            @Html.LabelFor(model => model.D.CIUDAD, "Ciudad", new { @id = "lbl_city" })
                        </div>
                    </div>
                </div>
            </div>
            <div class="col s12 m6 l6">
                <div class="row" style="margin-bottom:0">
                    <div class="card-panel">
                        <div class="row" style="margin-bottom:0">
                            <h5>Información general</h5>
                            <div class="input-field col s12">
                                @Html.EditorFor(model => model.D.FECHAC, new { htmlAttributes = new { @disabled = "disabled", @type = "text" } })
                                @Html.LabelFor(model => model.D.FECHAC, "Fecha", new { @id = "lbl_fechac" })
                            </div>
                            <div class="input-field col s6 l6">
                                @Html.EditorFor(model => model.D.PERIODO, new { htmlAttributes = new { @disabled = "disabled", @type = "text" } })
                                @Html.LabelFor(model => model.D.PERIODO, "Periodo", new { @id = "lbl_periodo" })
                            </div>
                            <div class="input-field col s6">
                                @Html.EditorFor(model => model.D.EJERCICIO, new { htmlAttributes = new { @disabled = "disabled", @type = "text" } })
                                @Html.LabelFor(model => model.D.EJERCICIO, "Ejercicio", new { @id = "lbl_ejer" })
                            </div>
                            <div class="input-field col s12">
                                @Html.EditorFor(model => model.D.CONCEPTO, new { htmlAttributes = new { @disabled = "disabled" } })
                                @Html.LabelFor(model => model.D.CONCEPTO, "Concepto", new { @id = "lbl_conce" })
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" style="margin-bottom:0">
                    <div class="card-panel">
                        <h5>Cliente @*@Html.DisplayFor(model => model.D.CLIENTE.KUNNR)*@</h5>
                        <div class="row" style="margin-bottom:0">
                            <div class="input-field col s12">
                                @Html.EditorFor(model => model.D.CLIENTE.KUNNR, new { htmlAttributes = new { @disabled = "disabled", @id = "payer_id" } })
                                @Html.LabelFor(model => model.D.CLIENTE.KUNNR)
                            </div>
                            <div class="input-field col s12">
                                @Html.EditorFor(model => model.D.CLIENTE.NAME1, new { htmlAttributes = new { @disabled = "disabled" } })
                                @Html.LabelFor(model => model.D.CLIENTE.NAME1, "Nombre", new { @id = "lbl_name" })
                            </div>
                            <div class="input-field col s12">
                                @Html.EditorFor(model => model.D.CLIENTE.STCD1, new { htmlAttributes = new { @disabled = "disabled" } })
                                @Html.LabelFor(model => model.D.CLIENTE.STCD1, "Taxid", new { @id = "lbl_stcd1" })
                            </div>
                            <div class="input-field col s12">
                                @Html.EditorFor(model => model.D.CLIENTE.CANAL, new { htmlAttributes = new { @disabled = "disabled", @id = "vtweg" } })
                                @Html.LabelFor(model => model.D.CLIENTE.CANAL, "Canal", new { @id = "lbl_stcd1" })
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="temp" class="col s12">
        <div class="row">
            <div class="card-panel">
                <div class="row" style="margin-bottom:0">
                    <h5>Vigencia</h5>
                    @*<div class="input-field col s12">
                            @Html.EditorFor(model => model.D.NUM_DOC, new { htmlAttributes = new { @disabled = "disabled" } })
                            @Html.LabelFor(model => model.D.NUM_DOC)
                        </div>*@
                    <div class="input-field col s6">
                        @Html.EditorFor(model => model.D.FECHAI_VIG, new { htmlAttributes = new { @disabled = "disabled", @type = "text" } })
                        @Html.LabelFor(model => model.D.FECHAI_VIG, "De", new { @id = "lbl_fechai" })
                    </div>
                    <div class="input-field col s6">
                        @Html.EditorFor(model => model.D.FECHAF_VIG, new { htmlAttributes = new { @disabled = "disabled", @type = "text" } })
                        @Html.LabelFor(model => model.D.FECHAF_VIG, "A", new { @id = "lbl_fechaf" })
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="supp" class="col s12">
        @{
            List<TAT001.Entities.DOCUMENTOA> archivos = ViewBag.files as List<TAT001.Entities.DOCUMENTOA>;
            string[] nombrefile;
        }
        <div class="row">
            <div class="col s12 m12 l6">
                <div class="card-panel">
                    <div class="row">
                        <h5>Soportes</h5>
                    </div>
                    <div class="row">
                        @using (Html.BeginForm("Descargar", "Solicitudes", FormMethod.Post))
                        {
                            try
                            {
                                for (int i = 0; i < archivos.Count; i++)
                                {
                                    nombrefile = archivos[i].PATH.Split('\\');
                                    <div class="file-field input-field">
                                        <button id="lbl_cargar" name="archivo" class="btn" type="submit" value="@archivos[i].PATH">DESCARGAR</button>
                                        <div class="file-path-wrapper">
                                            <input disabled value="@nombrefile[nombrefile.Length - 1]" id="disabled" type="text" class="file-path validate">
                                        </div>
                                    </div>
                                }
                            }
                            catch (Exception)
                            {
                            }
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="dist" class="col s12">
        <div class="row">
            <div class="card-panel">
                <div class="row" style="margin-bottom:0">
                    <h5>Distribución</h5>
                    <div class="input-field col s12">
                        @if (Model.D.DOCUMENTOPs.Count > 0)
                        {
                            <table>
                                <tr>
                                    <th>Vigencia de</th>
                                    <th>Vigencia a</th>
                                    <th>Material</th>
                                    <th>Desc</th>
                                    <th>Precio unitario</th>
                                    <th>% apoyo</th>
                                    <th>Apoyo por pieza</th>
                                    <th>Precio sugerido</th>
                                    <th>Volumen estimado</th>
                                    <th>Estimado apoyo</th>
                                </tr>
                                @foreach (var item in Model.D.DOCUMENTOPs)
                                {
                                    <tr>
                                        <td>@item.VIGENCIA_DE.Value.ToShortDateString()</td>
                                        <td>@item.VIGENCIA_AL.Value.ToShortDateString()</td>
                                        <td>@item.MATNR.TrimStart('0')</td>
                                        @{
                                            using (TAT001.Entities.TAT001Entities db = new TAT001.Entities.TAT001Entities())
                                            {
                                                var matnr = db.MATERIALs.Find(item.MATNR);
                                                <td>@matnr.MAKTX</td>
                                            }
                                        }
                                        <td>@Math.Round(item.MONTO, 2)</td>
                                        <td>@Math.Round(item.PORC_APOYO, 2)</td>
                                        <td>@Math.Round(item.MONTO_APOYO, 2)</td>
                                        <td>@Math.Round(item.PRECIO_SUG, 2)</td>
                                        <td>@Math.Round(item.VOLUMEN_EST, 2)</td>
                                        <td>@Math.Round(item.VOLUMEN_EST * item.MONTO_APOYO, 2)</td>
                                    </tr>

                                }
                            </table>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="fina" class="col s12">
        <div class="row">
            <div class="col s12 m6 l6">
                <div class="card-panel">
                    <h5>Detalle de solicitud</h5>
                    <div class="row" style="margin-bottom:0">
                        <div class="input-field col s8">
                            @if (ViewBag.accion == "N")
                            {
                                @Html.EditorFor(model => model.D.MONTO_DOC_MD)
                            }
                            @Html.EditorFor(model => model.D.MONTO_DOC_MD, new { htmlAttributes = new { @disabled = "disabled" } })
                            @Html.LabelFor(model => model.D.MONTO_DOC_MD, "Monto", new { @id = "lbl_montomd" })
                        </div>
                        <div class="input-field col s4">
                            @Html.EditorFor(model => model.D.MONEDA_ID, new { htmlAttributes = new { @disabled = "disabled" } })
                            @Html.LabelFor(model => model.D.MONEDA_ID, "Moneda", new { @id = "lbl_waers" })
                        </div>
                        <div class="input-field col s6">
                            @Html.EditorFor(model => model.D.TIPO_CAMBIO, new { htmlAttributes = new { @disabled = "disabled" } })
                            @Html.LabelFor(model => model.D.TIPO_CAMBIO, "Tipo de cambio", new { @id = "lbl_tcambio" })
                        </div>
                        <div class="input-field col s6">
                            @Html.EditorFor(model => model.D.MONTO_DOC_ML2, new { htmlAttributes = new { @disabled = "disabled" } })
                            @Html.LabelFor(model => model.D.MONTO_DOC_ML2, "Monto USD", new { @id = "lbl_montoml2" })
                        </div>
                        <div class="input-field col s12">
                            @Html.TextAreaFor(model => model.D.NOTAS, new { @id = "txt_notas", @class = "materialize-textarea", @style = "height:500px;", @disabled = "disabled" })
                            @Html.LabelFor(model => model.D.NOTAS, "Mecánica de negociación", new { @id = "lbl_notas" })
                        </div>
                    </div>
                </div>
            </div>
            <div class="col s12 m6 l6 right">
                <div class="card-panel">
                    <h5>Análisis Presupuesto</h5>
                    <div class="row" style="margin-bottom:0">
                        <ul class="collection">
                            <li class="collection-item">
                                <div class="row" style="margin-bottom:0;">
                                    <div class="col s4">
                                        Presupuesto canal
                                    </div>
                                    <div class="col s4">
                                        <label id="p_vtweg">aaaa</label>
                                    </div>
                                    <div class="col s4 right-align">
                                        <label id="p_canal">1111</label>
                                    </div>
                                </div>
                            </li>
                            <li class="collection-item">
                                <div class="row" style="margin-bottom:0;">
                                    <div class="col s4">
                                        Presupuesto cliente
                                    </div>
                                    <div class="col s4">
                                        <label id="p_kunnr"></label>
                                    </div>
                                    <div class="col s4 right-align">
                                        <label id="p_banner"></label>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="row">
                        <ul class="collection">
                            <li class="collection-item">
                                <div class="row" style="margin-bottom:0;">
                                    <div class="col s6">
                                        Registrado en SAP
                                    </div>
                                    <div class="col s6 right-align">
                                        <label id="pc_c"></label>
                                    </div>
                                </div>
                            </li>
                            <li class="collection-item">
                                <div class="row" style="margin-bottom:0;">
                                    <div class="col s6">
                                        Por registrar en SAP
                                    </div>
                                    <div class="col s6 right-align">
                                        <label id="pc_a"></label>
                                    </div>
                                </div>
                            </li>
                            <li class="collection-item">
                                <div class="row" style="margin-bottom:0;">
                                    <div class="col s6">
                                        En proceso TAT
                                    </div>
                                    <div class="col s6 right-align">
                                        <label id="pc_p"></label>
                                    </div>
                                </div>
                            </li>
                            <li class="collection-item">
                                <div class="row" style="margin-bottom:0;">
                                    <div class="col s6">
                                        Consumido
                                    </div>
                                    <div class="col s6 right-align">
                                        <label id="pc_t"></label>
                                    </div>
                                </div>
                            </li>
                            <li class="collection-item">
                                <div class="row" style="margin-bottom:0;">
                                    <div class="col s6">
                                        Presupuesto disponible
                                    </div>
                                    <div class="col s6 right-align">

                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            @*<div class="col s12 m6 l6">
                    <div class="card-panel">
                        <div class="row" style="margin-bottom:0">
                            <h5>Análisis presupuesto</h5>
                            <p>Presupuesto canal: 25,000.00</p>
                            <h5>Análisis solicitud</h5>
                            <p>importe Solicitud</p>
                        </div>
                    </div>
                </div>*@
        </div>
    </div>
    @*<div id="dist" class="col s12">Test 4</div>*@
</div>
<script>
    var el = document.getElementById("tab");
    options = [];
    var instance = M.Tabs.init(el, options);
</script>

@if (ViewBag.acciones != null)
{
    using (Html.BeginForm("Procesa", "Flujos"))
    {
        <div id="modal1" class="modal  bottom-sheet">
            @Html.AntiForgeryToken()

            <div class="modal-content">
                <div class="row">
                    <h4 id="txt_app" style="display:none">Aprobar solicitud</h4>
                    <h4 id="txt_rec" style="display:none">Rechazar solicitud</h4>
                    <h4 id="txt_nex" style="display:none">Agregar comentario</h4>
                    <br />
                </div>
                <div class="row" style="">
                    <div class="col s12 m12 l12">
                        <div class="row" style="margin-bottom:0">

                            @Html.HiddenFor(model => model.F.WORKF_ID)
                            @*@Html.LabelFor(model => model.F.WORKF_ID, new { @id = "lbl_userid" })*@

                            @Html.HiddenFor(model => model.F.WF_VERSION)
                            @*@Html.LabelFor(model => model.F.WF_VERSION, new { @id = "lbl_userid" })*@

                            @Html.HiddenFor(model => model.F.WF_POS)
                            @*@Html.LabelFor(model => model.F.WF_POS, new { @id = "lbl_userid" })*@

                            @Html.HiddenFor(model => model.F.NUM_DOC)
                            @*@Html.LabelFor(model => model.F.NUM_DOC, new { @id = "lbl_userid" })*@

                            @Html.HiddenFor(model => model.F.LOOP)
                            @*@Html.LabelFor(model => model.F.LOOP, new { @id = "lbl_userid" })*@

                            @Html.HiddenFor(model => model.F.ESTATUS, new { @id = "wf_estatus" })
                            @*@Html.LabelFor(model => model.F.ESTATUS, new { @id = "lbl_userid" })*@

                            <div class="input-field col s10 offset-s1">
                                @Html.TextAreaFor(model => model.F.COMENTARIO, new { @class = "materialize-textarea", @id = "txt_comentario" })
                                @Html.LabelFor(model => model.F.COMENTARIO, new { @id = "lbl_userid" })
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-fixed-footer right">
                <a href="#!" class="modal-action modal-close btn-flat">Cancelar</a>
                <input type="submit" value="Aceptar" class="modal-action modal-close btn-flat" onclick="document.getElementById('loader').style.display = 'initial';" />
                @*<a class="btn btn-default" href="@Url.Action("Details", "Solicitudes", new { id= Model.F.NUM_DOC})">Cancelar</a>*@
            </div>
        </div>
        if (ViewBag.accion == "R")
        {
            <div class="row" style="font-size:12px;">
                <div class="col s12">
                    <div class="row" style="margin-bottom:0">
                        <div class="card-panel">
                            <div class="row">
                                <h5>Trade Spending</h5>
                            </div>
                            <div class="row">
                                <div class="col l4 m4 s12">
                                    @foreach (var item in ViewBag.ts)
                                    {
                                        <div class="col s12">
                                            <p style="margin-top:0;">
                                                <label>
                                                    @foreach (var ii in item.TS_FORMT)
                                                    {
                                                        if (ii.SPRAS_ID == Session["spras"].ToString())
                                                        {
                                                            <input type="checkbox" id="chk-@ii.TSFORM_ID" name="chk-@ii.TSFORM_ID" />
                                                            <span>@ii.TXT100</span>
                                                        }
                                                    }
                                                </label>
                                            </p>
                                        </div>
                                    }
                                </div>
                                @*<div class="col s8 right-align">
                                        <input type="submit" value="Calificar" class="btn-small" />
                                    </div>*@
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
        <script>

            var elem = document.getElementById('modal1');
            var instance = M.Modal.init(elem, []);

            function aprobar() {
                document.getElementById("txt_app").style.display = 'initial';
                document.getElementById("txt_rec").style.display = 'none';
                document.getElementById("txt_nex").style.display = 'none';
                document.getElementById("txt_comentario").value = '';
                document.getElementById("wf_estatus").value = 'A';
            }
            function rechazar() {
                document.getElementById("txt_rec").style.display = 'initial';
                document.getElementById("txt_app").style.display = 'none';
                document.getElementById("txt_nex").style.display = 'none';
                document.getElementById("txt_comentario").value = '';
                document.getElementById("wf_estatus").value = 'R';
            }
            function siguiente() {
                document.getElementById("txt_rec").style.display = 'none';
                document.getElementById("txt_app").style.display = 'none';
                document.getElementById("txt_nex").style.display = 'initial';
                document.getElementById("txt_comentario").value = '';
                document.getElementById("wf_estatus").value = 'A';
            }
        </script>
    }
}

@if (ViewBag.tts.Count != 0)
{

    <div class="row" style="font-size:12px;">
        <div class="col s12">
            <div class="row" style="margin-bottom:0">
                <div class="card-panel">
                    <div class="row">
                        <h5>Trade Spending</h5>
                    </div>
                    <div class="row">
                        <div class="col l4 m4 s12">
                            @foreach (var item in ViewBag.tts)
                            {
                                <div class="col s12">
                                    <p style="margin-top:0;">
                                        <label>
                                            @foreach (var ii in item.TS_FORM.TS_FORMT)
                                            {
                                                if (ii.SPRAS_ID == Session["spras"].ToString())
                                                {
                                                    if (item.CHECKS)
                                                    {
                                                        <input type="checkbox" id="chk-@ii.TSFORM_ID" name="chk-@ii.TSFORM_ID" checked="checked" disabled="disabled" />
                                                    }
                                                    else
                                                    {
                                                        <input type="checkbox" id="chk-@ii.TSFORM_ID" name="chk-@ii.TSFORM_ID" disabled="disabled" />
                                                    }
                                                    <span>@ii.TXT100</span>
                                                }
                                            }
                                        </label>
                                    </p>
                                </div>
                            }
                        </div>
                        @*<div class="col s8 right-align">
                                <input type="submit" value="Calificar" class="btn-small" />
                            </div>*@
                    </div>
                </div>
            </div>
        </div>
    </div>
}

@if (ViewBag.workflow.Count != 0)
{
    <div class="row" style="font-size:12px;">
        <div class="col s12">
            <div class="row" style="margin-bottom:0">
                <div class="card-panel">
                    <h5>Workflow</h5>
                    @*<script src="//code.jquery.com/jquery-1.12.4.js"></script>
                        <script src="//cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
                        <script src="//cdn.datatables.net/1.10.16/js/dataTables.material.min.js"></script>
                        <link href="~/Content/dataTable.css" rel="stylesheet" />
                        <link href="//cdn.datatables.net/1.10.16/css/dataTables.material.min.css" rel="stylesheet" />*@
                    <table class="table highlight responsive-table" id="table">
                        <thead>
                            <tr>
                                <th width="">Usuario</th>
                                <th width="">Evento</th>
                                <th width="">Fecha</th>
                                <th width="">Fecha Procesada</th>
                                <th width="">Estatus</th>
                                <th width="30%">Comentario</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (TAT001.Entities.FLUJO f in ViewBag.workflow)
                            {
                                <tr>
                                    <td width="">@Html.DisplayFor(modelItem => f.USUARIOA_ID) - @Html.DisplayFor(modelItem => f.USUARIO.NOMBRE) @Html.DisplayFor(modelItem => f.USUARIO.APELLIDO_P) @Html.DisplayFor(modelItem => f.USUARIO.APELLIDO_M)</td>
                                    <td width="">@Html.DisplayFor(modelItem => f.WORKFP.ACCION.DESCCRIPCION)</td>
                                    <td width="">@Html.DisplayFor(modelItem => f.FECHAC)</td>
                                    <td width="">@Html.DisplayFor(modelItem => f.FECHAM)</td>
                                    <td width="">@Html.DisplayFor(modelItem => f.ESTATUS)</td>
                                    <td width="30%">@Html.DisplayFor(modelItem => f.COMENTARIO)</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

}
<p>
    @Html.ActionLink("Edit", "Edit", new { id = Model.D.NUM_DOC }) |
    @Html.ActionLink("Back to List", "Index")
</p>

<script>
    var canal = $('#vtweg').val();
    var canal = canal.split('-');
    canal[0] = $.trim(canal[0]);
    $('#p_vtweg').text(canal[0]);
    //Obtener cliente id
    var kunnr = $('#payer_id').val();
    //$('#cli_name').val();
    $('#p_kunnr').text(kunnr);
    var aaa = document.getElementById("payer_id").value;
    asignarPresupuesto(aaa);

    function asignarPresupuesto(kunnr) {

        $.ajax({
            type: "POST",
            url: '../../Listas/getPresupuesto',
            dataType: "json",
            data: { "kunnr": kunnr },

            success: function (data) {

                if (data !== null || data !== "") {
                    //$('#p_canal').text(data.P_CANAL);
                    //$('#p_banner').text(data.P_BANNER);
                    //$('#pc_c').text(data.PC_C);
                    //$('#pc_a').text(data.PC_A);
                    //$('#pc_p').text(data.PC_P);
                    //$('#pc_t').text(data.PC_T);
                    //RSG 26.04.2018----------------
                    $('#p_canal').text('$' + ((data.P_CANAL / 1).toFixed(2)));
                    $('#p_banner').text('$' + ((data.P_BANNER / 1).toFixed(2)));
                    $('#pc_c').text('$' + ((data.PC_C / 1).toFixed(2)));
                    $('#pc_a').text('$' + ((data.PC_A / 1).toFixed(2)));
                    $('#pc_p').text('$' + ((data.PC_P / 1).toFixed(2)));
                    $('#pc_t').text('$' + ((data.PC_T / 1).toFixed(2)));
                    //RSG 26.04.2018----------------
                }

            },
            error: function (xhr, httpStatusMessage, customErrorMessage) {
                M.toast({ html: httpStatusMessage });
            },
            async: false
        });

    }                                                                                                                                                                                                                                                                  //M.textareaAutoResize($('#txt_notas'));
</script>
