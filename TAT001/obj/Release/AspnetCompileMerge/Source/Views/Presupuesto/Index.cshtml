@model TAT001.Models.DatosPresupuesto
@{
    //ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.pagina_r = 301;
    ViewBag.carpeta_r = 300;
}
<script type="text/javascript" src="~/Scripts/jquery-3.0.0.min.js"></script>
<script type="text/javascript" src="~/Scripts/materialize.js"></script>
<script type="text/javascript" src="~/Scripts/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="~/Scripts/dataTables.fixedColumns.min.js"></script>
<script type="text/javascript" src="~/Scripts/dataTables.material.min.js"></script>
<link href="~/Content/dataTable.css" rel="stylesheet" />
<link href="//cdn.datatables.net/1.10.16/css/dataTables.material.min.css" rel="stylesheet" />
<script type="text/javascript">
    //var elem = document.querySelector('select');
    //var options=[];
    //var instance = M.Select.init(elem, options);
    $(document).ready(function () {
        $('select').select();
        try {
            var table = $('#table').DataTable({
                //scrollY: "70vh",
                dom: "Bfrtip",
                scrollX: "10vh",
                language: {
                    lengthMenu: "Display _MENU_ records per page",
                    zeroRecords: "No se encontraron datos",
                    info: "Página _PAGE_ de _PAGES_",
                    infoEmpty: "No hay datos",
                    infoFiltered: "(Filtrado de _MAX_ líneas totales)"
                },
                fixedColumns: true,
                fixedColumns: {
                    leftColumns: 4
                },
                columnDefs: [
                    {
                        //targets: [0, 1, 2],
                        className: 'mdl-data-table__cell--non-numeric'
                    }
                ]
            });

            var a = $('#selecc').val();
            table.page.len(a).draw();
            $('#selecc').on('change', function () {
                table.page.len(this.value).draw();
            });

            $('input.global_filter').on('keyup click', function () {
                filterGlobal();
            });
        } catch (e) {

        }
    });
    function filterGlobal() {
        $('#table').DataTable().search(
            $('#global_filter').val()).draw();
    }
</script>
<style>
    dataTables_length {
        display: none;
    }

    .dataTables_filter {
        display: none;
    }

    .dataTables_scrollHeadInner, .mdl-data-table {
        width: 100%;
    }
    /*.
    #fechUlt {
        text-align: left;
    }

    th {
        text-align: center;
    }

    #selection, #selec {
        margin-left: 2%;
    }

    #Button1 {
        margin-left: 2%;
    }*/
</style>

<div>
    @using (Html.BeginForm("Index", "Presupuesto", FormMethod.Post))
    {
        string[] defaulS = new string[1];
        string defaul = "";
        System.Globalization.TextInfo myTI = new System.Globalization.CultureInfo("en-US", false).TextInfo;
        System.Globalization.DateTimeFormatInfo formatoFecha = System.Globalization.CultureInfo.CurrentCulture.DateTimeFormat;
        int j = 0;

        <div class="row">
            <div class="input-field col s2">
                <select name="select" id="selec">
                    @try
                    {
                        defaul = Session["sociedad"].ToString();
                    }
                    catch (Exception)
                    {
                        <option value="" disabled selected></option>
                    }

                    @try
                    {
                        for (int i = 0; i < Model.sociedad.Count; i++)
                        {
                            if (defaul == Model.sociedad[i].BUKRS)
                            {
                                <option value="@Model.sociedad[i].BUKRS" selected="selected">@Model.sociedad[i].BUKRS</option>
                            }
                            else
                            {
                                <option value="@Model.sociedad[i].BUKRS">@Model.sociedad[i].BUKRS</option>
                            }
                        }
                    }
                    catch (Exception)
                    {
                        <option value="">No hay opciones</option>
                    }
                </select>
                <label id="lbl_bukrs">Sociedad</label>
            </div>
            @try
            {
                DateTime anio = DateTime.Today;
                if (ViewBag.anio != null)
                {
                    anio = Convert.ToDateTime("01/01/" + ViewBag.anio);
                }
                <div class="input-field col s1" id="selection">
                    <select name="anioconsu">
                        @if (Session["anioconsu"] != null)
                        {
                            while (anio <= DateTime.Today)
                            {
                                if (Session["anioconsu"].ToString() == anio.Year.ToString())
                                {
                                    <option selected value="@anio.Year">@anio.Year</option>
                                }
                                else
                                {
                                    <option value="@anio.Year">@anio.Year</option>
                                }
                                anio = anio.AddYears(1);
                            }
                        }
                        else
                        {
                            <option value="" disabled selected></option>
                            while (anio <= DateTime.Today)
                            {
                                if (j == 0)
                                {
                                    <option selected value="@anio.Year">@anio.Year</option>
                                }
                                else
                                {
                                    <option value="@anio.Year">@anio.Year</option>
                                }
                                anio = anio.AddYears(1);
                            }
                        }

                    </select>
                    <label>Año</label>
                </div>
            }
            catch (Exception)
            {
            }
            @if (Session["periodoconsu"] != null)
            {
            string periodo = Session["periodoconsu"].ToString();
            <div class="input-field col s2" id="selection">
                <select name="periodoconsu">
                    <option value="">Todos</option>
                    @for (int i = 1; i < 13; i++)
                    {
                        if (i.ToString() == periodo)
                        {
                            <option selected value="@i">@myTI.ToTitleCase(formatoFecha.GetMonthName(i))</option>
                        }
                        else
                        {
                            <option value="@i">@myTI.ToTitleCase(formatoFecha.GetMonthName(i))</option>
                        }
                    }
                </select>
                <label>Periodo</label>
            </div>
            }
            else
            {
            <div class="input-field col s2" id="selection">
                <select name="periodoconsu">
                    <option value="" disabled selected></option>
                    <option value="1">Enero</option>
                    <option value="2">Febrero</option>
                    <option value="3">Marzo</option>
                    <option value="4">Abril</option>
                    <option value="5">Mayo</option>
                    <option value="6">Junio</option>
                    <option value="7">Julio</option>
                    <option value="8">Agosto</option>
                    <option value="9">Septiembre</option>
                    <option value="10">Octubre</option>
                    <option value="11">Noviembre</option>
                    <option value="12">Diciembre</option>
                </select>
                <label>Periodo</label>
            </div>
            }
            <div class="input-field col s2">
                <select name="cambio" id="selec">
                    @try
                    {
                        defaul = Session["cambio"].ToString();
                    }
                    catch (Exception)
                    {
                        <option value="" disabled selected></option>
                    }

                    @try
                    {
                        string cambio = "";
                        for (int i = 0; i < Model.cambio.Count; i++)
                        {
                            cambio = Model.cambio[i].FCURR + "-" + Model.cambio[i].TCURR;
                            if (defaul == cambio)
                            {
                                <option value="@cambio" selected="selected">@Model.cambio[i].TCURR</option>
                            }
                            else
                            {
                                <option value="@cambio">@Model.cambio[i].TCURR</option>
                            }
                        }
                    }
                    catch (Exception)
                    {
                        <option value="">No hay opciones</option>
                    }

                </select>
                <label id="lbl_waers">Moneda</label>
            </div>
            <div class="col s5 right-align">
                <button id="lbl_cargar" class="btn-small blue-grey" type="submit">
                    Cargar
                </button>
                <p id="fechUlt"><label id="lbl_last">Ultima fecha de carga CPT: </label> @ViewBag.ultMod</p>
            </div>
        </div>
    }
</div>
@if (Model.presupuesto.Count > 0)
{
<div>
    <div class="row" style="margin-bottom:0;">
        <div class="input-field col s3 m3 l3">
            <select id="selecc">
                <option value="10" selected>10</option>
                <option value="20">20</option>
                <option value="25">25</option>
                <option value="30">30</option>
            </select>
            <label>Ver por página</label>
        </div>
        <div class="input-field col s3 m3 l3 offset-l6 offset-m6">
            <input type="text" class="global_filter" id="global_filter">
            <label for="global_filter">Buscar</label>
        </div>
    </div>
    <script>
        var elem = document.querySelector('#selecc');
        var options = [];
        var instance = M.Select.init(elem, options);
    </script>


    <table class="table mdl-data-table table-striped centered" id="table">
        <thead>
            <tr>
                <th>Canal</th>
                <th>Total Canal</th>
                <th>Banner</th>
                <th>PPTO Banner</th>
                @*<th>GRSLS</th>
                    <th>RECSL</th>
                    <th>INDLB</th>
                    <th>FRGHT</th>
                    <th>PURCH</th>
                    <th>RAWMT</th>
                    <th>PKGMT</th>
                    <th>OVHDV</th>
                    <th>OVHDF</th>
                    <th>DIRLB</th>*@
                <th>VVX17</th>
                <th>CSHDC</th>
                <th>RECUN</th>
                <th>DSTRB</th>
                <th>OTHTA</th>
                <th>ADVER</th>
                <th>CORPM</th>
                <th>POP</th>
                <th>PMVAR</th>
                <th>CONPR</th>
                <th>RSRDV</th>
                <th>SPA</th>
                <th>FREEG</th>
                @*<th>PKGDS</th>
                    <th>NETLB</th>
                    <th>SLLBS</th
                    <th>SLCAS</th>
                    <th>PRCAS</th>
                    <th>NPCAS</th>
                    <th>ILVAR</th>
                    <th>BILBK</th>
                    <th>OVHVV</th>
                    <th>OHV  </th>*@
                <th>Consumido</th>
                <th>PPTO Disponible</th>
            </tr>
        </thead>

        @for (int i = 0; i < Model.presupuesto.Count; i++)
        {
            <tr>
                <td>@Model.presupuesto[i].CANAL</td>
                <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].PPTOC)</td>
                <td>@Model.presupuesto[i].BANNER</td>
                <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].PPTO)</td>
                @*<td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].GRSLS)</td>*@
                @*<td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].RECSL)</td>*@
                @*<td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].INDLB)</td>*@
                @*<td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].FRGHT)</td>*@
                @*<td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].PURCH)</td>*@
                @*<td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].RAWMT)</td>*@
                @*<td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].PKGMT)</td>*@
                @*<td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].OVHDV)</td>*@
                @*<td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].OVHDF)</td>*@
                @*<td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].DIRLB)</td>*@
                <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].VVX17)</td>
                <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].CSHDC)</td>
                <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].RECUN)</td>
                <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].DSTRB)</td>
                <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].OTHTA)</td>
                <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].ADVER)</td>
                <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].CORPM)</td>
                <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].POP)</td>
                <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].PMVAR)</td>
                <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].CONPR)</td>
                <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].RSRDV)</td>
                <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].SPA)</td>
                <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].FREEG)</td>
                @*<td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].PKGDS)</td>
                    <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].NETLB)</td>
                    <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].SLLBS)</td>
                    <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].SLCAS)</td>
                    <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].PRCAS)</td>
                    <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].NPCAS)</td>
                    <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].ILVAR)</td>
                    <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].BILBK)</td>
                    <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].OVHVV)</td>*@
                @*<td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].OHV)</td>*@
                @if (Model.presupuesto[i].CONSU > 0)
                {
                    <td>$-@String.Format("{0:0,0.000}", Model.presupuesto[i].CONSU)</td>
                }
                else if (Model.presupuesto[i].CONSU == 0)
                {
                    <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].CONSU)</td>
                }
                else
                {
                    <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].CONSU)</td>
                }
                <td>$@String.Format("{0:0,0.000}", Model.presupuesto[i].TOTAL)</td>
            </tr>
        }
    </table>
</div>
}


